(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[512],{3218:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/project",function(){return n(5514)}])},5514:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return b}});var r=n(5893),s=n(1163),c=n(7294),i=n(9669),o=n.n(i);function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var u=function(e){e.addDevsList;var t=e.setAddDevsList,n=e.assigned,s=e.setProject,i=e.project,a=(0,c.useState)(),u=a[0],h=a[1],j=(0,c.useState)(),m=(j[0],j[1],function(e){var t=i.assigned;t.push(e),s(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){l(e,t,n[t])}))}return e}({},i,{assigned:d(t)}))});return(0,c.useEffect)((function(){u||o().get("/api/user/all",{withCredentials:!0}).then((function(e){var t=e.data.data.filter((function(e){if(e.isDeveloper)return e}));h(t)})).catch((function(e){return console.log(e)}))}),[]),(0,r.jsxs)("div",{className:"add-devs-list",children:[(0,r.jsx)("h1",{style:{textAlign:"center"},children:"Available"}),(0,r.jsxs)("div",{className:"devs-list",children:[u&&u.map((function(e,t){if(!n.includes(e.fullName))return(0,r.jsx)("h4",{onClick:function(){return m(e.fullName)},children:e.fullName},t)})),(0,r.jsx)("button",{onClick:function(){return t(!1)},children:"X"})]})]})};function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var j=function(e){var t=e.projectId,n=e.setTicketForm,s=e.project,i=e.setProject,a=(0,c.useState)(),l=a[0],d=a[1],u=(0,c.useState)(),j=u[0],m=u[1],p=(0,c.useState)(),f=p[0],v=p[1],x=function(e){e.preventDefault(),o().post("/api/project/ticket",{id:t,title:l,info:j,severity:f},{withCredentials:!0}).then((function(e){return i(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){h(e,t,n[t])}))}return e}({},s,{tickets:e.data.data}))})).catch((function(e){return console.log(e)})),d(""),m(""),v(),n(!1)};return(0,r.jsxs)("div",{className:"ticket-form-container",children:[(0,r.jsxs)("div",{className:"title-section",children:[(0,r.jsx)("h1",{className:"title",children:"ticket form"}),(0,r.jsx)("button",{onClick:function(){return n(!1)},className:"btn",style:{fontSize:"14pt"},children:"x"})]}),(0,r.jsx)("p",{className:"project-id",children:t}),(0,r.jsxs)("form",{onSubmit:function(e){return x(e)},className:"ticket-form",children:[(0,r.jsxs)("div",{className:"section",children:[(0,r.jsx)("label",{htmlFor:"title",children:"Title"}),(0,r.jsx)("input",{type:"text",placeholder:"title",onChange:function(e){return d(e.target.value)}})]}),(0,r.jsxs)("div",{className:"section",children:[(0,r.jsx)("label",{htmlFor:"info",children:"Info"}),(0,r.jsx)("input",{type:"text",placeholder:"info",onChange:function(e){return m(e.target.value)}})]}),(0,r.jsxs)("div",{className:"section",children:[(0,r.jsx)("label",{htmlFor:"severity",children:"Severity 0-3"}),(0,r.jsx)("input",{type:"number",name:"severity",onChange:function(e){return v(e.target.value)}})]}),(0,r.jsx)("button",{type:"submit",className:"btn",children:"Submit Ticket"})]})]})},m=function(e){var t=e.ticket,n=e.projectId,i=e.ticketId,a=(e.project,e.setProject),l=(0,c.useState)(),d=l[0],u=l[1];(0,s.useRouter)();return(0,r.jsx)(r.Fragment,{children:t&&!t.resolved&&(0,r.jsx)("div",{className:"comment-form-container",children:(0,r.jsxs)("form",{className:"comment-form",onSubmit:function(e){return function(e){e.stopPropagation(),e.preventDefault(),console.log(e.target.content.value),o().post("/api/project/ticket/comment",{content:d,projectId:n,ticketId:i},{withCredentials:!0}).then((function(e){return a(e.data.data)})).catch((function(e){return console.log(e)})),e.target.content.value="",u()}(e)},children:[(0,r.jsxs)("div",{className:"section",children:[(0,r.jsx)("label",{htmlFor:"content",children:"Comment:"}),(0,r.jsx)("input",{onClick:function(e){return e.stopPropagation()},type:"text",name:"content",autoComplete:"off",min:10,onChange:function(e){return u(e.target.value)}})]}),(0,r.jsx)("button",{onClick:function(e){return e.stopPropagation()},className:"btn",children:"Send"})]})})})},p=function(e){e.resolveTicketPrompt;var t=e.setResolveTicketPrompt,n=e.projectId,c=e.ticket,i=e.setProject;(0,s.useRouter)();return(0,r.jsx)("div",{onClick:function(e){return e.stopPropagation()},className:"resolve-ticket-container",children:(0,r.jsxs)("div",{className:"resolve-ticket-prompt",children:[(0,r.jsxs)("h4",{children:["Mark ticket as ",c.resolved?"unresolved":"resolved"]}),(0,r.jsxs)("h4",{children:["current : ",c.resolved.toString()]}),(0,r.jsx)("h5",{children:"Are you sure?"}),(0,r.jsx)("button",{className:"btn",onClick:function(e){o().patch("/api/project/ticket",{projectId:n,ticketId:c._id,resolved:!c.resolved},{withCredentials:!0}).then((function(e){return i(e.data.data)})).catch((function(e){return console.log(e)})),t(!1)},children:"Confirm"}),(0,r.jsx)("button",{className:"btn",onClick:function(e){t(!1)},children:"Cancel"})]})},c._id)},f=function(e){var t=e.ticket,n=e.projectId,s=e.setProject,i=(e.user,(0,c.useState)()),a=i[0],l=i[1];return(0,r.jsxs)(r.Fragment,{children:[t&&!t.resolved&&(0,r.jsx)("div",{className:"ticket-update-form-container",children:(0,r.jsxs)("form",{onSubmit:function(e){return function(e){e.stopPropagation(),e.preventDefault();var r=t._id;o().post("/api/project/ticket/updates",{projectId:n,ticketId:r,content:a},{withCredentials:!0}).then((function(e){return s(e.data.data)})).catch((function(e){return console.log(e)}))}(e)},className:"ticket-update-form",children:[(0,r.jsxs)("div",{className:"section",children:[(0,r.jsx)("label",{htmlFor:"updateContent",children:"Update"}),(0,r.jsx)("input",{autoComplete:"off",type:"text",name:"updateContent",placeholder:"update content",onChange:function(e){return l(e.target.value)}})]}),(0,r.jsx)("button",{className:"btn",children:"Submit Update"})]})})," "]})},v=function(e){var t=e.ticket,n=e.projectId,s=e.project,i=e.setProject,o=(0,c.useRef)(null),a=(0,c.useState)(!1),l=a[0],d=a[1],u=(0,c.useState)(!0),h=u[0],j=u[1],v=(0,c.useState)(!1),x=v[0],b=v[1];return(0,r.jsxs)("div",{ref:o,onClick:function(){return d(!l),void o.current.scrollIntoView({behavior:"smooth"})},className:l?"ticket-card ticket-card-expanded":"ticket-card ticket-card-retracted",children:[x&&(0,r.jsx)(p,{projectId:n,ticket:t,setProject:i,project:s,resolveTicketPrompt:x,setResolveTicketPrompt:b},t._id),(0,r.jsxs)("div",{className:"ticket-section-title",children:[(0,r.jsxs)("h4",{children:["Ticket: ",t.title]}),(0,r.jsxs)("h4",{children:["Submitted by: ",t.author]})]}),(0,r.jsxs)("div",{className:"ticket-section",children:[(0,r.jsx)("h3",{children:"Info:"}),(0,r.jsx)("p",{className:"ticket-info",children:l?t.info:"".concat(t.info.slice(0,180),"...")})]}),t&&l&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"ticket-section",children:[(0,r.jsxs)("h4",{children:["Created: ",t.createdAt.slice(0,10)]}),(0,r.jsxs)("h4",{children:["Updated: ",t.updatedAt.slice(0,10)]})]}),(0,r.jsxs)("div",{className:"ticket-section",children:[(0,r.jsx)("h4",{children:"Updates:"}),(0,r.jsxs)("h3",{children:["severity: ",t.severity]}),(0,r.jsxs)("h3",{children:["resolved : ",t.resolved?"yes":"no"]}),(0,r.jsx)("button",{onClick:function(e){e.stopPropagation(),b(!0)},className:"btn",style:{fontSize:"14pt",zIndex:"100"},children:"Update Ticket"})]}),(0,r.jsxs)("div",{onClick:function(e){return e.stopPropagation()},className:"ticket-controller",children:[(0,r.jsx)("div",{className:"comments-container",onClick:function(e){return e.stopPropagation()},children:(0,r.jsxs)("div",{className:"comments-overlay",children:[h&&(0,r.jsx)(m,{ticket:t,project:s,setProject:i,commentFormView:h,setCommentFormView:j,projectId:n,ticketId:t._id}),(0,r.jsx)("div",{children:t.comments&&t.comments.map((function(e,n){return(0,r.jsx)("div",{className:t&&t.author===e.author?"comments comments-author":"comments comments-dev",children:(0,r.jsxs)("p",{children:[(0,r.jsxs)("span",{className:"comment-author-span",children:[e.author,":"]}),e.content]},e._id)})}))})]})}),(0,r.jsx)("div",{className:"ticket-actions",onClick:function(e){return e.stopPropagation()},children:(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"ticket-updates-header",children:[(0,r.jsxs)("h2",{children:["Status: ",t.resolved?"Resolved.":"In progress"]}),(0,r.jsxs)("h2",{children:["updates: ",t.updates.length]})]}),(0,r.jsx)("div",{className:"updates-section section",children:t.updates&&t.updates.map((function(e,t){return(0,r.jsxs)("div",{className:"ticket-update",children:[(0,r.jsx)("h4",{className:"ticket-update-author",children:e.author}),(0,r.jsx)("h4",{className:"ticket-update-content",children:e.content})]},e._id)}))}),(0,r.jsx)("div",{className:"section",children:t&&(0,r.jsx)(f,{ticket:t,project:s,setProject:i,projectId:n})})]})})]})]})]},t._id)};function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var b=function(e){var t=e.user,n=(0,c.useState)(!1),i=n[0],a=n[1],l=(0,c.useState)(!1),d=l[0],h=l[1],m=(0,c.useState)(),p=m[0],f=m[1],b=(0,s.useRouter)(),g=(0,c.useState)(!1),k=g[0],N=g[1],y=(0,c.useState)(),C=y[0],P=y[1],S=b.query.projectId,w=function(e){if(C.assigned.length<=1)return console.log("must be at least 1 dev available");var t=C.assigned.filter((function(t){if(e!=t)return t}));P(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){x(e,t,n[t])}))}return e}({},C,{assigned:t}))};return(0,c.useEffect)((function(){C||o().get("/api/project/one/".concat(S),{withCredentials:!0}).then((function(e){P(e.data.data)})).catch((function(e){return console.log(e)}))}),[]),(0,r.jsxs)("div",{className:"page-container",children:[(0,r.jsx)("h1",{className:"title",children:"Project"}),(0,r.jsx)("button",{onClick:function(){return b.replace("/myProjects")},className:"back-btn btn",children:"Back"}),C&&(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:"body",children:[(0,r.jsx)("h1",{children:C.title}),(0,r.jsxs)("div",{className:"grid",children:[(0,r.jsxs)("div",{className:"project-page-section small",children:[(0,r.jsxs)("h4",{style:{textTransform:"capitalize"},children:["Current Status: ",C.status]}),t&&t.isAdmin&&(0,r.jsxs)("select",{onChange:function(e){return f(e.target.value)},children:[(0,r.jsx)("option",{value:C.status,children:"default"}),(0,r.jsx)("option",{value:"in-progress",children:"in-progress"}),(0,r.jsx)("option",{value:"testing",children:"testing"}),(0,r.jsx)("option",{value:"deployment",children:"deployment"}),(0,r.jsx)("option",{value:"complete",children:"complete"})]})]}),(0,r.jsxs)("div",{className:"project-page-section",children:[(0,r.jsx)("h4",{children:"assigned:"}),(0,r.jsx)("div",{className:"assigned-list",children:C&&C.assigned&&C.assigned.map((function(e,n){return(0,r.jsx)("div",{children:C&&t&&C.assigned.length>=2&&t.isAdmin?(0,r.jsx)("h4",{className:"dev-remove",onClick:function(){return w(e)},children:e}):(0,r.jsxs)("h4",{className:"dev-handle",children:[e,","]})},n)}))}),t&&t.isAdmin&&(0,r.jsx)("button",{onClick:function(){return N(!k)},children:"+"}),k&&t&&t.isAdmin&&(0,r.jsx)(u,{project:C,setProject:P,assigned:C.assigned,addDevsList:k,setAddDevsList:N})]})]}),(0,r.jsxs)("div",{className:"project-page-section",children:[(0,r.jsxs)("h4",{children:["Project Created:"," ",C.createdAt&&C.createdAt.slice(0,10)]}),(0,r.jsxs)("h4",{children:["Project last updated:"," ",C.updatedAt&&C.updatedAt.slice(0,10)]})]}),(0,r.jsxs)("div",{className:"ticket-section",children:[(0,r.jsxs)("h1",{children:["Tickets: ",C.tickets&&C.tickets.length]}),(0,r.jsxs)("h4",{children:["resolved:"," ",C.tickets&&C.tickets.filter((function(e){return e.resolved})).length]}),(0,r.jsxs)("h4",{children:["active:"," ",C.tickets&&C.tickets.filter((function(e){return!e.resolved})).length]}),(0,r.jsx)("button",{onClick:function(){return h(!d)},className:"btn",children:"+ Post Ticket"})]}),(0,r.jsxs)("div",{className:"tickets-grid",children:[(0,r.jsx)("h1",{style:{marginTop:"4rem"},className:"title",children:"active"}),C.tickets&&C.tickets.map((function(e){if(!e.resolved)return(0,r.jsx)("div",{className:"active-ticket",children:(0,r.jsx)(v,{ticket:e,projectId:C._id,project:C,setProject:P},e._id)})})),(0,r.jsx)("h1",{style:{marginTop:"4rem"},className:"title",children:"Resolved"}),C.tickets&&C.tickets.map((function(e){if(e.resolved)return(0,r.jsx)("div",{className:"inactive-ticket",children:(0,r.jsx)(v,{ticket:e,projectId:C._id,project:C,setProject:P},e._id)})}))]}),d&&(0,r.jsx)(j,{project:C,setProject:P,setTicketForm:h,projectId:C._id}),(0,r.jsx)("h4",{style:{color:"grey"},children:C._id}),t&&t.isAdmin&&(0,r.jsx)("button",{className:"save-btn btn",onClick:function(){o().patch("/api/project/",{id:C._id,status:p,assigned:C.assigned},{withCredentials:!0}).then((function(e){return P(e.data.data)})).catch((function(e){return console.log(e)}))},children:"save"}),(0,r.jsx)("div",{className:"delete-btn-container",children:t&&t.isAdmin&&(0,r.jsxs)(r.Fragment,{children:[i&&(0,r.jsxs)("div",{className:"delete-project-prompt",children:[(0,r.jsx)("h4",{children:"Are you sure you want to permanently remove project and all content?"}),(0,r.jsxs)("div",{className:"section",children:[(0,r.jsx)("button",{className:"btn delete-btn",onClick:function(){return function(e){var t={id:e};return o().delete("/api/project/",{withCredentials:!0,data:t}).then((function(e){return consle.log(e)})).catch((function(e){return console.log(e)})),b.replace("/myProjects")}(C._id)},children:"Confirm"}),(0,r.jsx)("button",{className:"btn delete-btn",onClick:function(){return a(!1)},children:"Cancel"})]})]}),!i&&(0,r.jsx)("button",{onClick:function(){return a(!0)},className:"btn delete-btn",children:"Delete Project"})]})})]})})]})}}},function(e){e.O(0,[774,888,179],(function(){return t=3218,e(e.s=t);var t}));var t=e.O();_N_E=t}]);